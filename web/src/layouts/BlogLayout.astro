---
import Layout from './Layout.astro';

interface Props {
  title: string;
  description: string;
  publishDate: string;
  author?: string;
  heroImage?: string;
  heroImageAlt?: string;
  readingTime?: string;
  keywords?: string[];
}

const {
  title,
  description,
  publishDate,
  author = "Twinbolt",
  heroImage,
  heroImageAlt,
  readingTime = "5 min read",
  keywords = []
} = Astro.props;

const siteUrl = "https://stuga.app";
const canonicalUrl = new URL(Astro.url.pathname, siteUrl).href;

function formatDate(dateStr: string) {
  const date = new Date(dateStr);
  return date.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' });
}

const articleSchema = {
  "@type": "BlogPosting",
  "headline": title,
  "description": description,
  "datePublished": publishDate,
  "dateModified": publishDate,
  "author": {
    "@type": "Organization",
    "name": author,
    "url": "https://twinbolt.se"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Twinbolt AB",
    "url": "https://twinbolt.se",
    "logo": {
      "@type": "ImageObject",
      "url": `${siteUrl}/icon.png`
    }
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": canonicalUrl
  },
  "image": heroImage ? `${siteUrl}${heroImage}` : `${siteUrl}/og-image.png`,
  "keywords": keywords.join(", ")
};

const breadcrumbSchema = {
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Stuga",
      "item": `${siteUrl}/`
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "Blog",
      "item": `${siteUrl}/blog`
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": title,
      "item": canonicalUrl
    }
  ]
};

const additionalSchema = [articleSchema, breadcrumbSchema];
---

<Layout
  title={`${title} | Stuga Blog`}
  description={description}
  additionalSchema={additionalSchema}
  ogType="article"
>
  <header class="px-4 py-4 border-b border-border">
    <div class="flex items-center justify-center gap-2">
      <a href="/" class="flex items-center gap-2 hover:opacity-80 transition-opacity">
        <img src="/icon.png" alt="Stuga" class="w-8 h-8 rounded-lg shadow-sm" />
        <span class="font-bold text-lg">Stuga</span>
      </a>
    </div>
  </header>

  <nav aria-label="Breadcrumb" class="px-6 py-3 text-sm border-b border-border/50">
    <ol class="flex items-center gap-2 max-w-2xl mx-auto">
      <li><a href="/" class="text-muted hover:text-accent transition-colors">Stuga</a></li>
      <li class="text-muted">/</li>
      <li><a href="/blog" class="text-muted hover:text-accent transition-colors">Blog</a></li>
      <li class="text-muted">/</li>
      <li class="text-foreground font-medium truncate max-w-[200px]">{title}</li>
    </ol>
  </nav>

  <main class="px-6 py-12">
    <article class="max-w-2xl mx-auto">
      <header class="mb-10">
        <div class="flex items-center gap-3 text-sm text-muted mb-4">
          <time datetime={publishDate}>{formatDate(publishDate)}</time>
          <span class="w-1 h-1 bg-border rounded-full"></span>
          <span>{readingTime}</span>
        </div>
        <h1 class="text-3xl sm:text-4xl font-bold tracking-tight mb-4 leading-tight">{title}</h1>
        <p class="text-lg text-muted leading-relaxed">{description}</p>
      </header>

      {heroImage && (
        <figure class="mb-10 flex flex-col items-center">
          <div class="bg-card rounded-2xl overflow-hidden border border-border shadow-lg max-w-[280px] sm:max-w-[320px]">
            <img
              src={heroImage}
              alt={heroImageAlt || title}
              class="w-full"
              loading="eager"
            />
          </div>
          {heroImageAlt && (
            <figcaption class="text-sm text-muted mt-3 text-center">{heroImageAlt}</figcaption>
          )}
        </figure>
      )}

      <div class="prose prose-warm">
        <slot />
      </div>

      <footer class="mt-12 pt-8 border-t border-border">
        <div class="flex flex-col sm:flex-row gap-6 items-start sm:items-center justify-between">
          <div>
            <p class="text-muted text-sm mb-2">Ready to try Stuga?</p>
            <a href="/#download" class="btn-primary inline-flex items-center gap-2 text-sm px-4 py-2">
              Get the app
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3" />
              </svg>
            </a>
          </div>
          <a href="/blog" class="text-accent hover:underline text-sm font-medium">
            Read more articles
          </a>
        </div>
      </footer>
    </article>
  </main>

  <footer class="py-8 px-6 border-t border-border">
    <div class="max-w-2xl mx-auto flex items-center justify-between text-sm text-muted">
      <span>&copy; 2026 Twinbolt AB</span>
      <div class="flex gap-4">
        <a href="/blog" class="hover:text-foreground transition-colors">Blog</a>
        <a href="/privacy" class="hover:text-foreground transition-colors">Privacy</a>
        <a href="https://github.com/twinbolt-ab/stuga" class="hover:text-foreground transition-colors">GitHub</a>
      </div>
    </div>
  </footer>
</Layout>

<style is:global>
  .prose {
    @apply text-foreground;
  }
  .prose h2 {
    @apply text-2xl font-bold mt-10 mb-4 tracking-tight;
  }
  .prose h3 {
    @apply text-xl font-bold mt-8 mb-3 tracking-tight;
  }
  .prose p {
    @apply mb-5 leading-relaxed text-muted;
  }
  .prose a {
    @apply text-accent hover:underline;
  }
  .prose ul, .prose ol {
    @apply mb-5 pl-6 space-y-2;
  }
  .prose ul {
    @apply list-disc;
  }
  .prose ol {
    @apply list-decimal;
  }
  .prose li {
    @apply text-muted leading-relaxed;
  }
  .prose strong {
    @apply text-foreground font-semibold;
  }
  .prose code {
    @apply bg-card px-1.5 py-0.5 rounded text-sm font-mono border border-border;
  }
  .prose pre {
    @apply bg-card p-4 rounded-xl overflow-x-auto mb-5 border border-border;
  }
  .prose pre code {
    @apply bg-transparent border-0 p-0;
  }
  .prose blockquote {
    @apply border-l-4 border-accent pl-4 italic text-muted my-6;
  }
  .prose img {
    @apply rounded-xl my-6;
  }
  .prose figure.phone-screenshot {
    @apply flex flex-col items-center my-8;
  }
  .prose figure.phone-screenshot img {
    @apply max-w-[280px] sm:max-w-[320px] w-full rounded-2xl shadow-lg border border-border;
  }
  .prose figure.phone-screenshot figcaption {
    @apply text-sm text-muted mt-3 text-center;
  }
  .prose .tip {
    @apply bg-card border border-border rounded-xl p-4 my-6;
  }
  .prose .tip-title {
    @apply font-bold text-foreground mb-2 flex items-center gap-2;
  }
  .prose .comparison-table {
    @apply w-full my-6 border-collapse;
  }
  .prose .comparison-table th {
    @apply text-left p-3 bg-card border-b border-border font-semibold;
  }
  .prose .comparison-table td {
    @apply p-3 border-b border-border text-muted;
  }
</style>
